{"version":3,"sources":["nsyslog-parser.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","module","$","parser","NSyslog","parse","window","Pri","RXS","Array","prototype","peek","item","shift","undefined","trim","assign","entry","host","appName","pid","messageid","structuredData","line","pri","match","originalMessage","prival","parseInt","get","facilityval","facility","levelval","level","FACILITY","id","LEVEL","NaN","items","substring","split","endparse","prinmr","version","type","ts","Date","month","day","time","year","getYear","unshift","invalidate","message","join","endsWith","eitem","replace","invalid","chain","pop","sdata","idx","map","nokeys","lastKey","indexOf","forEach","kv","fields","prop","header","err","label","FACILITY_MAP","LEVEL_MAP","LEVELS","FACILITIES","val1","val2"],"mappings":"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","file":"nsyslog-parser.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\n\n(function($) {\n\tvar parser = require(\"./parser.js\");\n\t$.NSyslog = $.NSyslog || {};\n\t$.NSyslog.parse = parser;\n})(window);\n\n},{\"./parser.js\":2}],2:[function(require,module,exports){\nconst\n\tPri = require(\"./pri.js\");\n\nconst RXS = {\n\t\"pri\" : /^<\\d+>/,\n\t\"prinmr\" : /^\\d+ /,\n\t\"prival\" : /<(\\d+)>/,\n\t\"month\" : /^[a-zA-Z]{3} /,\n\t\"day\" : /^\\d{1,2} /,\n\t\"time\" : /^\\d+:\\d+:\\d+ /,\n\t\"ts\" : /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\S+ /,\n\t\"invalid\" : /[^a-zA-Z0-9\\.\\$\\-_#%\\/]/,\n\t\"sdata\" : /\\[(\\S+)( [^\\=]+\\=\\\"[^\\\"]+\\\")+\\]/g,\n}\n\nArray.prototype.peek = function() {\n\tdo {\n\t\tvar item = this.shift();\n\t\tif(item===undefined) return item;\n\t\telse item = item.trim();\n\t}while(!item);\n\n\treturn item;\n}\n\nfunction assign(entry,item) {\n\tif(!entry.host) entry.host = item.trim();\n\telse if(!entry.appName) entry.appName = item.trim();\n\telse if(!entry.pid) entry.pid = item.trim();\n\telse if(!entry.messageid) entry.messageid = item.trim();\n\telse if(!entry.structuredData) entry.structuredData = item.trim();\n\telse return true;\n}\n\nfunction parse(line) {\n\tvar pri = line.match(RXS.pri);\n\tvar entry = {\n\t\toriginalMessage : line\n\t};\n\n\t// First priority\n\tif(pri) {\n\t\tentry.pri = pri[0];\n\t\tentry.prival = parseInt(entry.pri.match(RXS.prival)[1]);\n\t\tvar prival = Pri.get(entry.prival);\n\t\tentry.facilityval = prival.facility;\n\t\tentry.levelval = prival.level;\n\t\tentry.facility = Pri.FACILITY[prival.facility].id;\n\t\tentry.level = Pri.LEVEL[prival.level].id;\n\t}\n\telse {\n\t\tentry.pri = \"\";\n\t\tentry.prival = NaN;\n\t}\n\n\t//Split message\n\tvar items = line.substring(entry.pri.length).split(\" \");\n\n\t// Date search\n\tvar endparse = false;\n\twhile(line.length && !endparse) {\n\t\tvar item = items.peek()+\" \";\n\n\t\t// RFC RFC5424\n\t\tif(item.match(RXS.prinmr)) {\n\t\t\tentry.version = parseInt(item);\n\t\t\tentry.type = \"RFC5424\";\n\t\t\titem = items.peek()+\" \";\n\t\t\tif(item.match(RXS.ts)) {\n\t\t\t\tentry.ts = new Date(Date.parse(item.match(RXS.ts)[0].trim()));\n\t\t\t}\n\t\t}\n\t\t// BSD\n\t\telse if(item.match(RXS.month)) {\n\t\t\tentry.type = \"BSD\";\n\t\t\tvar month = item.trim();\n\t\t\tvar day = items.peek();\n\t\t\tvar time = items.peek();\n\t\t\tvar year = new Date().getYear() + 1900\n\t\t\tentry.ts = new Date(Date.parse(year+\" \"+month+\" \"+day+\" \"+time));\n\t\t}\n\t\telse {\n\t\t\tentry.type = \"UNKNOWN\";\n\t\t\titems.unshift(item.trim());\n\t\t}\n\t\tendparse = true;\n\t}\n\n\t// No timestamp\n\tif(!entry.ts) entry.ts = new Date();\n\n\t// Is a standard syslog message\n\tif(entry.type) {\n\t\tendparse = false;\n\n\t\tfunction invalidate(item) {\n\t\t\titems.unshift(item);\n\t\t\tentry.message = items.join(\" \");\n\t\t\tendparse = true;\n\t\t}\n\n\t\twhile(line.length && !endparse) {\n\t\t\tvar item = items.peek();\n\t\t\tif(!item) {\n\t\t\t\tendparse = true;\n\t\t\t}\n\t\t\telse if(item.endsWith(\":\")){\n\t\t\t\tlet eitem = item.replace(/:$/,\"\").trim();\n\t\t\t\tif(eitem.match(RXS.invalid)) {\n\t\t\t\t\tinvalidate(item);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tassign(entry,eitem)\n\t\t\t\t\tentry.message = items.join(\" \");\n\t\t\t\t\tendparse = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(!items.length) {\n\t\t\t\tinvalidate(item);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Invalid item (malformed message)\n\t\t\t\tif(item.match(RXS.invalid)) {\n\t\t\t\t\tinvalidate(item);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar r = assign(entry,item.replace(/: $/,\"\").trim())\n\t\t\t\t\tif(r) {\n\t\t\t\t\t\titems.unshift(item);\n\t\t\t\t\t\tentry.message = items.join(\" \");\n\t\t\t\t\t\tendparse = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\telse {\n\t\tentry.message = items.join(\" \");\n\t}\n\n\t// Chained hostnames\n\tentry.chain = (entry.host||\"\").split(\"/\");\n\tentry.host = entry.chain.pop();\n\n\t// Structured data\n\tif(entry.type==\"RFC5424\") {\n\t\tvar sdata = entry.message.match(RXS.sdata) || [];\n\t\tvar idx=0;\n\t\tentry.structuredData = sdata.map(item=>{\n\t\t\tvar map = {}, nokeys = [];\n\t\t\tvar lastKey = null;\n\t\t\tidx = entry.message.indexOf(item)+item.length+1;\n\t\t\titem.replace(/(^\\[)|(\\]$)/g,\"\").split(\" \").forEach((t,i)=>{\n\t\t\t\t// Extra space\n\t\t\t\tif(!t.trim()) return;\n\t\t\t\t// First element (ID of data)\n\t\t\t\tif(i==0) {\n\t\t\t\t\tmap[\"$id\"] = t;\n\t\t\t\t}\n\t\t\t\t// Key/Pair values\n\t\t\t\telse {\n\t\t\t\t\tvar kv = t.split(\"=\");\n\t\t\t\t\t// Correct key/value pair\n\t\t\t\t\tif(kv[0] && kv[1] && kv[1]!='\"') {\n\t\t\t\t\t\tlastKey = kv.shift();\n\t\t\t\t\t\tmap[lastKey] = kv.join(\"=\").replace(/\\\"/g,\"\");\n\t\t\t\t\t}\n\t\t\t\t\t// Last key had values separated by spaces\n\t\t\t\t\telse if(kv[0] && kv[1]===undefined){\n\t\t\t\t\t\tmap[lastKey] += \" \"+(kv[0]||\"\").replace(/\\\"/g,\"\");\n\t\t\t\t\t}\n\t\t\t\t\telse if(kv[0] && (!kv[1].length || kv[1]=='\"')){\n\t\t\t\t\t\tmap[lastKey] += \" \"+(kv[0]||\"\").replace(/\\\"/g,\"\")+\"=\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn map;\n\t\t});\n\t\tentry.message = entry.message.substring(idx);\n\t}\n\n\t// Message with fields\n\tvar fields = [];\n\tentry.message.split(\",\").forEach(kv=>{\n\t\tvar prop = kv.split(\"=\");\n\t\tif(prop.length==2)\n\t\t\tfields[prop[0]] = prop[1];\n\t});\n\tentry.fields = fields;\n\n\t// header\n\tentry.header = line.substring(0,line.length-entry.message.length);\n\n\treturn entry;\n}\n\nmodule.exports = function(line) {try {return parse(line)}catch(err){return {err:err}}};\n\n},{\"./pri.js\":3}],3:[function(require,module,exports){\nconst FACILITY = [\n\t{id:\"kern\", label:\"kernel messages\"},\n\t{id:\"user\", label:\"user-level messages\"},\n\t{id:\"mail\", label:\"mail system\"},\n\t{id:\"daemon\", label:\"system daemons\"},\n\t{id:\"auth\", label:\"security/authorization messages\"},\n\t{id:\"syslog\", label:\"messages generated internally by syslogd\"},\n\t{id:\"lpr\", label:\"line printer subsystem\"},\n\t{id:\"news\", label:\"network news subsystem\"},\n\t{id:\"uucp\", label:\"UUCP subsystem\"},\n\t{id:\"cron\", label:\"clock daemon\"},\n\t{id:\"authpriv\", label:\"security/authorization messages\"},\n\t{id:\"ftp\", label:\"FTP daemon\"},\n\t{id:\"ntp\", label:\"NTP subsystem\"},\n\t{id:\"security\", label:\"log audit\"},\n\t{id:\"console\", label:\"log alert\"},\n\t{id:\"solaris-cron\", label:\"clock daemon\"},\n\t{id:\"local0\", label:\"locally used facility 0\"},\n\t{id:\"local1\", label:\"locally used facility 0\"},\n\t{id:\"local2\", label:\"locally used facility 0\"},\n\t{id:\"local3\", label:\"locally used facility 0\"},\n\t{id:\"local4\", label:\"locally used facility 0\"},\n\t{id:\"local5\", label:\"locally used facility 0\"},\n\t{id:\"local6\", label:\"locally used facility 0\"},\n\t{id:\"local7\", label:\"locally used facility 0\"}\n];\n\nconst LEVEL = [\n\t{id:\"emerg\", label:\"system is unusable\"},\n\t{id:\"alert\", label:\"action must be taken immediately\"},\n\t{id:\"crit\", label:\"critical conditions\"},\n\t{id:\"error\", label:\"error conditions\"},\n\t{id:\"warn\", label:\"warning conditions\"},\n\t{id:\"notice\", label:\"normal but significant condition\"},\n\t{id:\"info\", label:\"informational messages\"},\n\t{id:\"debug\", label:\"debug-level messages\"}\n]\n\nvar FACILITY_MAP = [];\nvar LEVEL_MAP = [];\n\nFACILITY.forEach((f,i)=>FACILITY_MAP[f.id]=i);\nLEVEL.forEach((l,i)=>LEVEL_MAP[l.id]=i);\n\nmodule.exports.LEVEL = LEVEL;\nmodule.exports.FACILITY = FACILITY;\nmodule.exports.LEVELS = LEVEL_MAP;\nmodule.exports.FACILITIES = FACILITY_MAP;\nmodule.exports.get = function(val1,val2) {\n\tif(typeof(val1)==\"number\" && typeof(val2)==\"undefined\") {\n\t\treturn {\n\t\t\tlevel : val1 & 0x7,\n\t\t\tfacility : val1 >> 3\n\t\t}\n\t}\n\telse if(typeof(val1)==\"number\" && typeof(val2)==\"number\") {\n\t\treturn val1*8 + val2;\n\t}\n\telse if(typeof(val1)==\"string\" && typeof(val2)==\"number\") {\n\t\treturn (FACILITY_MAP[val1]||0)*8 + val2;\n\t}\n\telse if(typeof(val1)==\"number\" && typeof(val2)==\"string\") {\n\t\treturn val1*8 + (LEVEL_MAP[val2]||0);\n\t}\n\telse if(typeof(val1)==\"string\" && typeof(val2)==\"string\") {\n\t\treturn (FACILITY_MAP[val1]||0)*8 + (LEVEL_MAP[val2]||0);\n\t}\n\telse {\n\t\treturn {level:0, facility:0}\n\t}\n}\n\n},{}]},{},[1]);\n"]}